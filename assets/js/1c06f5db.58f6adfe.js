"use strict";(globalThis.webpackChunkmimoe_devportal=globalThis.webpackChunkmimoe_devportal||[]).push([[172],{8089(e,n,t){t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"api/agent-kit","title":"Agent Kit","description":"API reference for @mimik/agent-kit. Build intelligent AI agents with MCP tool orchestration","source":"@site/docs/api/agent-kit.md","sourceDirName":"api","slug":"/api/agent-kit","permalink":"/webdemo/docs/api/agent-kit","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":10,"frontMatter":{"sidebar_position":10,"title":"Agent Kit","description":"API reference for @mimik/agent-kit. Build intelligent AI agents with MCP tool orchestration"},"sidebar":"apiSidebar","previous":{"title":"WASM mim Runtime API","permalink":"/webdemo/docs/api/wasm-runtime"}}');var l=t(4848),s=t(8453);const r={sidebar_position:10,title:"Agent Kit",description:"API reference for @mimik/agent-kit. Build intelligent AI agents with MCP tool orchestration"},o="Agent Kit",a={},c=[{value:"Installation",id:"installation",level:2},{value:"Quick Start",id:"quick-start",level:2},{value:"Agent Class",id:"agent-class",level:2},{value:"Constructor",id:"constructor",level:3},{value:"Configuration Options",id:"configuration-options",level:4},{value:"LLM Configuration",id:"llm-configuration",level:4},{value:"Methods",id:"methods",level:2},{value:"<code>initialize()</code>",id:"initialize",level:3},{value:"<code>run(input, options)</code>",id:"runinput-options",level:3},{value:"MCP Endpoints Configuration",id:"mcp-endpoints-configuration",level:2},{value:"Simple Configuration",id:"simple-configuration",level:3},{value:"Advanced Configuration",id:"advanced-configuration",level:3},{value:"Endpoint Options",id:"endpoint-options",level:3},{value:"Streaming Events",id:"streaming-events",level:2},{value:"Event Types",id:"event-types",level:3},{value:"iteration_start",id:"iteration_start",level:4},{value:"content_delta",id:"content_delta",level:4},{value:"raw_model_stream_event",id:"raw_model_stream_event",level:4},{value:"tool_calls_detected",id:"tool_calls_detected",level:4},{value:"tool_approval_result",id:"tool_approval_result",level:4},{value:"tool_results",id:"tool_results",level:4},{value:"conversation_complete",id:"conversation_complete",level:4},{value:"max_iterations_reached",id:"max_iterations_reached",level:4},{value:"Tool Approval",id:"tool-approval",level:2},{value:"Approval Callback",id:"approval-callback",level:3},{value:"Approval Response Format",id:"approval-response-format",level:3},{value:"Approval Options",id:"approval-options",level:3},{value:"Example: Block Destructive Operations",id:"example-block-destructive-operations",level:3},{value:"Examples",id:"examples",level:2},{value:"Basic Usage",id:"basic-usage",level:3},{value:"Multi-Server with Security",id:"multi-server-with-security",level:3},{value:"Qwen3 No-Think Mode",id:"qwen3-no-think-mode",level:3},{value:"Collecting Final Result Only",id:"collecting-final-result-only",level:3},{value:"Error Handling",id:"error-handling",level:2},{value:"Connection Errors",id:"connection-errors",level:3},{value:"Tool Execution Errors",id:"tool-execution-errors",level:3},{value:"Error Recovery",id:"error-recovery",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"1. Always Handle Streaming",id:"1-always-handle-streaming",level:3},{value:"2. Layer Security Controls",id:"2-layer-security-controls",level:3},{value:"3. Use Dynamic Port and API Keys",id:"3-use-dynamic-port-and-api-keys",level:3},{value:"4. Set Appropriate Limits",id:"4-set-appropriate-limits",level:3},{value:"Related",id:"related",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"agent-kit",children:"Agent Kit"})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"@mimik/agent-kit"})," provides the ",(0,l.jsx)(n.strong,{children:"agentic loop"})," that powers AI Agent mims. It handles LLM communication, MCP tool discovery, function calling orchestration, and streaming, so you can focus on configuring your agent's behavior."]}),"\n",(0,l.jsxs)(n.p,{children:["For the concepts behind agent-kit, see ",(0,l.jsx)(n.a,{href:"/docs/ai-foundation/development/how-ai-agent-mims-work",children:"How AI Agent mims Work"}),"."]}),"\n",(0,l.jsx)(n.admonition,{title:"mimOE JavaScript Runtime",type:"info",children:(0,l.jsxs)(n.p,{children:["This library is designed to work within the mimOE JavaScript runtime (Duktape ES5). It uses ",(0,l.jsx)(n.code,{children:"global.http"})," for HTTP requests and ",(0,l.jsx)(n.code,{children:"global.context"})," for runtime APIs. See ",(0,l.jsx)(n.a,{href:"/docs/ai-foundation/development/create-ai-agent",children:"Create an AI Agent"})," for a hands-on tutorial."]})}),"\n",(0,l.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"npm install @mimik/agent-kit\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-javascript",children:"const { Agent } = require('@mimik/agent-kit');\n"})}),"\n",(0,l.jsx)(n.h2,{id:"quick-start",children:"Quick Start"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-javascript",children:"const { Agent } = require('@mimik/agent-kit');\n\nconst { httpPort } = global.context.info;\nconst { INFERENCE_API_KEY } = global.context.env;\n\nconst agent = new Agent({\n  name: 'My Assistant',\n  instructions: 'You are a helpful assistant with access to MCP tools.',\n  llm: {\n    endpoint: `http://127.0.0.1:${httpPort}/mimik-ai/openai/v1/chat/completions`,\n    apiKey: `Bearer ${INFERENCE_API_KEY}`,\n    model: 'qwen3-1.7b',\n    temperature: 0.1\n  },\n  mcpEndpoints: ['http://localhost:3000/mcp'],\n  httpClient: global.http\n});\n\n// Run a conversation (returns streaming iterator)\nconst stream = await agent.run('find devices around me');\n\nfor await (const event of stream) {\n  if (event.type === 'content_delta') {\n    console.log(event.data.content);\n  } else if (event.type === 'conversation_complete') {\n    console.log('Done:', event.data.finalOutput);\n    break;\n  }\n}\n"})}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"agent-class",children:"Agent Class"}),"\n",(0,l.jsx)(n.h3,{id:"constructor",children:"Constructor"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-javascript",children:"new Agent(config)\n"})}),"\n",(0,l.jsx)(n.p,{children:"Creates a new Agent instance."}),"\n",(0,l.jsx)(n.h4,{id:"configuration-options",children:"Configuration Options"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"Property"}),(0,l.jsx)(n.th,{children:"Type"}),(0,l.jsx)(n.th,{children:"Required"}),(0,l.jsx)(n.th,{children:"Default"}),(0,l.jsx)(n.th,{children:"Description"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"name"})}),(0,l.jsx)(n.td,{children:"string"}),(0,l.jsx)(n.td,{children:"No"}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"'MCP Assistant'"})}),(0,l.jsx)(n.td,{children:"Agent name for logging"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"instructions"})}),(0,l.jsx)(n.td,{children:"string"}),(0,l.jsx)(n.td,{children:"No"}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"'You are a helpful assistant...'"})}),(0,l.jsx)(n.td,{children:"System prompt"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"maxIterations"})}),(0,l.jsx)(n.td,{children:"number"}),(0,l.jsx)(n.td,{children:"No"}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"5"})}),(0,l.jsx)(n.td,{children:"Maximum conversation loops"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"mcpEndpoints"})}),(0,l.jsx)(n.td,{children:"array"}),(0,l.jsx)(n.td,{children:"No"}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"[]"})}),(0,l.jsx)(n.td,{children:"MCP server configurations"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"httpClient"})}),(0,l.jsx)(n.td,{children:"object"}),(0,l.jsx)(n.td,{children:"Yes"}),(0,l.jsx)(n.td,{children:"-"}),(0,l.jsxs)(n.td,{children:["HTTP client instance (",(0,l.jsx)(n.code,{children:"global.http"}),")"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"llm"})}),(0,l.jsx)(n.td,{children:"object"}),(0,l.jsx)(n.td,{children:"No"}),(0,l.jsx)(n.td,{children:"-"}),(0,l.jsx)(n.td,{children:"LLM configuration"})]})]})]}),"\n",(0,l.jsx)(n.h4,{id:"llm-configuration",children:"LLM Configuration"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"Property"}),(0,l.jsx)(n.th,{children:"Type"}),(0,l.jsx)(n.th,{children:"Default"}),(0,l.jsx)(n.th,{children:"Description"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"endpoint"})}),(0,l.jsx)(n.td,{children:"string"}),(0,l.jsx)(n.td,{children:"-"}),(0,l.jsx)(n.td,{children:"LLM API endpoint URL"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"apiKey"})}),(0,l.jsx)(n.td,{children:"string"}),(0,l.jsx)(n.td,{children:"-"}),(0,l.jsxs)(n.td,{children:["LLM API key (include ",(0,l.jsx)(n.code,{children:"Bearer"})," prefix)"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"model"})}),(0,l.jsx)(n.td,{children:"string"}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"'qwen3-1.7b'"})}),(0,l.jsx)(n.td,{children:"Model name"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"temperature"})}),(0,l.jsx)(n.td,{children:"number"}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"0.1"})}),(0,l.jsx)(n.td,{children:"Sampling temperature (0.0-1.0)"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"max_tokens"})}),(0,l.jsx)(n.td,{children:"number"}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"2048"})}),(0,l.jsx)(n.td,{children:"Maximum tokens per response"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"no_think"})}),(0,l.jsx)(n.td,{children:"boolean"}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"false"})}),(0,l.jsxs)(n.td,{children:["Append ",(0,l.jsx)(n.code,{children:"/no_think"})," to prompts (Qwen3)"]})]})]})]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"methods",children:"Methods"}),"\n",(0,l.jsx)(n.h3,{id:"initialize",children:(0,l.jsx)(n.code,{children:"initialize()"})}),"\n",(0,l.jsxs)(n.p,{children:["Connects to all MCP servers and loads available tools. Called automatically on first ",(0,l.jsx)(n.code,{children:"run()"})," if not called explicitly."]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-javascript",children:"await agent.initialize();\n"})}),"\n",(0,l.jsx)(n.h3,{id:"runinput-options",children:(0,l.jsx)(n.code,{children:"run(input, options)"})}),"\n",(0,l.jsx)(n.p,{children:"Executes a conversation with streaming output."}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"Parameter"}),(0,l.jsx)(n.th,{children:"Type"}),(0,l.jsx)(n.th,{children:"Description"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"input"})}),(0,l.jsx)(n.td,{children:"string | array"}),(0,l.jsx)(n.td,{children:"User message string, or array of OpenAI-format messages for conversation history"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"options.toolApproval"})}),(0,l.jsx)(n.td,{children:"function"}),(0,l.jsx)(n.td,{children:"Optional tool approval callback"})]})]})]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Returns:"})," ",(0,l.jsx)(n.code,{children:"AsyncIterator"})," (streaming events)"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-javascript",children:"// Simple string message\nconst stream = await agent.run('help me find devices');\n\n// Or with conversation history (OpenAI messages format)\nconst stream = await agent.run([\n  { role: 'user', content: 'What devices are on my network?' },\n  { role: 'assistant', content: 'I found 3 devices: ...' },\n  { role: 'user', content: 'Tell me more about the first one' }\n], {\n  toolApproval: async (toolCalls) => ({\n    stopAfterExecution: false,\n    approvals: toolCalls.map(() => true)\n  })\n});\n"})}),"\n",(0,l.jsx)(n.p,{children:"When passing a messages array, the agent's system instructions are automatically prepended."}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"mcp-endpoints-configuration",children:"MCP Endpoints Configuration"}),"\n",(0,l.jsx)(n.p,{children:"MCP endpoints can be configured as simple strings or objects with advanced options."}),"\n",(0,l.jsx)(n.h3,{id:"simple-configuration",children:"Simple Configuration"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-javascript",children:"mcpEndpoints: [\n  'http://localhost:3000/mcp',\n  'http://localhost:3001/mcp'\n]\n"})}),"\n",(0,l.jsx)(n.h3,{id:"advanced-configuration",children:"Advanced Configuration"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-javascript",children:"mcpEndpoints: [\n  // Simple endpoint - all tools allowed\n  'http://localhost:3000/mcp',\n\n  // Endpoint with API key\n  {\n    url: 'http://localhost:3001/mcp',\n    apiKey: 'server-api-key'\n  },\n\n  // Endpoint with tool whitelist (include mode)\n  {\n    url: 'http://localhost:3002/mcp',\n    options: {\n      toolWhitelist: ['readFile', 'listDirectory'],\n      whitelistMode: 'include'  // Only these tools allowed\n    }\n  },\n\n  // Endpoint blocking specific tools (exclude mode)\n  {\n    url: 'http://localhost:3003/mcp',\n    options: {\n      toolWhitelist: ['deleteFile', 'formatDisk'],\n      whitelistMode: 'exclude'  // All tools except these\n    }\n  }\n]\n"})}),"\n",(0,l.jsx)(n.h3,{id:"endpoint-options",children:"Endpoint Options"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"Property"}),(0,l.jsx)(n.th,{children:"Type"}),(0,l.jsx)(n.th,{children:"Description"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"url"})}),(0,l.jsx)(n.td,{children:"string"}),(0,l.jsx)(n.td,{children:"MCP server URL"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"apiKey"})}),(0,l.jsx)(n.td,{children:"string"}),(0,l.jsx)(n.td,{children:"Optional API key for the server"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"options.toolWhitelist"})}),(0,l.jsx)(n.td,{children:"array"}),(0,l.jsx)(n.td,{children:"Tool names to include/exclude"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"options.whitelistMode"})}),(0,l.jsx)(n.td,{children:"string"}),(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.code,{children:"'include'"})," or ",(0,l.jsx)(n.code,{children:"'exclude'"})]})]})]})]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"streaming-events",children:"Streaming Events"}),"\n",(0,l.jsx)(n.p,{children:"All agent conversations emit real-time events."}),"\n",(0,l.jsx)(n.h3,{id:"event-types",children:"Event Types"}),"\n",(0,l.jsx)(n.h4,{id:"iteration_start",children:"iteration_start"}),"\n",(0,l.jsx)(n.p,{children:"Emitted at the start of each conversation loop."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-javascript",children:"{\n  type: 'iteration_start',\n  data: {\n    iteration: 1,\n    messages: [/* conversation history */]\n  }\n}\n"})}),"\n",(0,l.jsx)(n.h4,{id:"content_delta",children:"content_delta"}),"\n",(0,l.jsx)(n.p,{children:"Emitted for each text content update from the assistant."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-javascript",children:"{\n  type: 'content_delta',\n  data: {\n    content: \"I'll help you find devices...\"\n  }\n}\n"})}),"\n",(0,l.jsx)(n.h4,{id:"raw_model_stream_event",children:"raw_model_stream_event"}),"\n",(0,l.jsx)(n.p,{children:"Raw streaming event from the LLM."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-javascript",children:"{\n  type: 'raw_model_stream_event',\n  data: {\n    type: 'model',\n    event: { /* raw LLM event */ }\n  }\n}\n"})}),"\n",(0,l.jsx)(n.h4,{id:"tool_calls_detected",children:"tool_calls_detected"}),"\n",(0,l.jsx)(n.p,{children:"Emitted when the model wants to call tools."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-javascript",children:'{\n  type: \'tool_calls_detected\',\n  data: {\n    toolCalls: [{\n      id: "call_123",\n      type: "function",\n      function: {\n        name: "discoverLocal",\n        arguments: "{}"\n      }\n    }]\n  }\n}\n'})}),"\n",(0,l.jsx)(n.h4,{id:"tool_approval_result",children:"tool_approval_result"}),"\n",(0,l.jsx)(n.p,{children:"Emitted after tool approval decisions are made."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-javascript",children:"{\n  type: 'tool_approval_result',\n  data: {\n    approvalResult: {\n      stopAfterExecution: false,\n      approvals: [true, { approve: false, reason: 'Not allowed' }]\n    }\n  }\n}\n"})}),"\n",(0,l.jsx)(n.h4,{id:"tool_results",children:"tool_results"}),"\n",(0,l.jsx)(n.p,{children:"Emitted after tool execution completes."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-javascript",children:'{\n  type: \'tool_results\',\n  data: {\n    results: [{\n      role: "tool",\n      tool_call_id: "call_123",\n      name: "discoverLocal",\n      content: JSON.stringify([/* results */])\n    }]\n  }\n}\n'})}),"\n",(0,l.jsx)(n.h4,{id:"conversation_complete",children:"conversation_complete"}),"\n",(0,l.jsx)(n.p,{children:"Emitted when the conversation is complete."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-javascript",children:"{\n  type: 'conversation_complete',\n  data: {\n    finalOutput: \"I found 2 devices around you...\",\n    messages: [/* complete history */],\n    iterations: 2,\n    stoppedAfterToolExecution: false\n  }\n}\n"})}),"\n",(0,l.jsx)(n.h4,{id:"max_iterations_reached",children:"max_iterations_reached"}),"\n",(0,l.jsx)(n.p,{children:"Emitted when max iterations limit is reached."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-javascript",children:"{\n  type: 'max_iterations_reached',\n  data: {\n    maxIterations: 5,\n    finalOutput: \"...\"\n  }\n}\n"})}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"tool-approval",children:"Tool Approval"}),"\n",(0,l.jsx)(n.p,{children:"Control which tools the agent can execute at runtime."}),"\n",(0,l.jsx)(n.h3,{id:"approval-callback",children:"Approval Callback"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-javascript",children:"const stream = await agent.run(message, {\n  toolApproval: async (toolCalls) => {\n    // toolCalls = [{ id, type, function: { name, arguments } }, ...]\n\n    return {\n      stopAfterExecution: false,  // Continue conversation after execution\n      approvals: [\n        true,                     // Approve first tool\n        false,                    // Deny second tool\n        { approve: true },        // Explicit approval\n        { approve: false, reason: 'Not safe' }  // Denial with reason\n      ]\n    };\n  }\n});\n"})}),"\n",(0,l.jsx)(n.h3,{id:"approval-response-format",children:"Approval Response Format"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"Property"}),(0,l.jsx)(n.th,{children:"Type"}),(0,l.jsx)(n.th,{children:"Description"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"stopAfterExecution"})}),(0,l.jsx)(n.td,{children:"boolean"}),(0,l.jsx)(n.td,{children:"End conversation after tool execution"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"approvals"})}),(0,l.jsx)(n.td,{children:"array"}),(0,l.jsx)(n.td,{children:"Approval decision for each tool call"})]})]})]}),"\n",(0,l.jsx)(n.h3,{id:"approval-options",children:"Approval Options"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"true"})," - Approve the tool"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"false"})," - Deny the tool (default reason)"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"{ approve: true }"})," - Explicit approval"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"{ approve: false, reason: 'Custom reason' }"})," - Denial with custom reason"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"example-block-destructive-operations",children:"Example: Block Destructive Operations"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-javascript",children:"toolApproval: async (toolCalls) => ({\n  stopAfterExecution: false,\n  approvals: toolCalls.map(tool => {\n    if (tool.function.name.includes('delete')) {\n      return { approve: false, reason: 'Destructive operations not allowed' };\n    }\n    return true;\n  })\n})\n"})}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,l.jsx)(n.h3,{id:"basic-usage",children:"Basic Usage"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-javascript",children:"const { Agent } = require('@mimik/agent-kit');\n\nasync function* runAgent(userMessage) {\n  const { httpPort } = global.context.info;\n  const { INFERENCE_API_KEY } = global.context.env;\n\n  const agent = new Agent({\n    name: 'Basic Assistant',\n    instructions: 'You are a helpful assistant.',\n    llm: {\n      endpoint: `http://127.0.0.1:${httpPort}/mimik-ai/openai/v1/chat/completions`,\n      apiKey: `Bearer ${INFERENCE_API_KEY}`,\n      model: 'qwen3-1.7b',\n      temperature: 0.1\n    },\n    mcpEndpoints: ['http://localhost:3000/mcp'],\n    httpClient: global.http\n  });\n\n  const stream = await agent.run(userMessage);\n\n  for await (const event of stream) {\n    if (event.type === 'content_delta') {\n      yield { type: 'content', content: event.data.content };\n    } else if (event.type === 'conversation_complete') {\n      yield { type: 'done', finalOutput: event.data.finalOutput };\n      break;\n    }\n  }\n}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"multi-server-with-security",children:"Multi-Server with Security"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-javascript",children:"const agent = new Agent({\n  name: 'Secure Agent',\n  instructions: 'Help users with controlled tool access.',\n  llm: {\n    endpoint: `http://127.0.0.1:${httpPort}/mimik-ai/openai/v1/chat/completions`,\n    apiKey: `Bearer ${INFERENCE_API_KEY}`,\n    model: 'qwen3-1.7b',\n    temperature: 0.1,\n    max_tokens: 4096\n  },\n  mcpEndpoints: [\n    // Network tools - only discovery\n    {\n      url: 'http://localhost:3000/mcp',\n      options: {\n        toolWhitelist: ['discoverLocal', 'pingDevice'],\n        whitelistMode: 'include'\n      }\n    },\n    // File tools - block destructive\n    {\n      url: 'http://localhost:3001/mcp',\n      options: {\n        toolWhitelist: ['deleteFile', 'formatDisk'],\n        whitelistMode: 'exclude'\n      }\n    }\n  ],\n  httpClient: global.http\n});\n"})}),"\n",(0,l.jsx)(n.h3,{id:"qwen3-no-think-mode",children:"Qwen3 No-Think Mode"}),"\n",(0,l.jsx)(n.p,{children:"For faster, more direct responses without reasoning display:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-javascript",children:"const agent = new Agent({\n  name: 'Direct Assistant',\n  llm: {\n    endpoint: `http://127.0.0.1:${httpPort}/mimik-ai/openai/v1/chat/completions`,\n    apiKey: `Bearer ${INFERENCE_API_KEY}`,\n    model: 'qwen3-1.7b',\n    no_think: true  // Appends /no_think to prompts\n  },\n  mcpEndpoints: ['http://localhost:3000/mcp'],\n  httpClient: global.http\n});\n"})}),"\n",(0,l.jsx)(n.h3,{id:"collecting-final-result-only",children:"Collecting Final Result Only"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-javascript",children:"const stream = await agent.run('find devices around me');\nlet finalResult = null;\n\nfor await (const event of stream) {\n  if (event.type === 'conversation_complete') {\n    finalResult = event.data;\n    break;\n  }\n}\n\nconsole.log('Output:', finalResult.finalOutput);\nconsole.log('Iterations:', finalResult.iterations);\n"})}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,l.jsx)(n.h3,{id:"connection-errors",children:"Connection Errors"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-javascript",children:"try {\n  await agent.initialize();\n} catch (error) {\n  console.error('Failed to connect to MCP servers:', error.message);\n}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"tool-execution-errors",children:"Tool Execution Errors"}),"\n",(0,l.jsx)(n.p,{children:"Tool errors are returned in results; the conversation continues:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-javascript",children:'{\n  type: \'tool_results\',\n  data: {\n    results: [{\n      role: "tool",\n      tool_call_id: "call_123",\n      name: "failingTool",\n      content: JSON.stringify({ error: "Tool execution failed" })\n    }]\n  }\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"error-recovery",children:"Error Recovery"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Server Failures"}),": Agent continues with available servers"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Tool Failures"}),": Returned as error messages, conversation continues"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Approval Callback Errors"}),": Defaults to denying all tools for safety"]}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,l.jsx)(n.h3,{id:"1-always-handle-streaming",children:"1. Always Handle Streaming"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-javascript",children:"for await (const event of stream) {\n  switch (event.type) {\n    case 'content_delta':\n      displayContent(event.data.content);\n      break;\n    case 'tool_calls_detected':\n      showToolExecution(event.data.toolCalls);\n      break;\n    case 'conversation_complete':\n      return event.data.finalOutput;\n  }\n}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"2-layer-security-controls",children:"2. Layer Security Controls"}),"\n",(0,l.jsx)(n.p,{children:"Combine whitelisting with runtime approval:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-javascript",children:"// Server-level whitelist\n{\n  url: 'http://localhost:3000/mcp',\n  options: {\n    toolWhitelist: ['readFile', 'writeFile'],\n    whitelistMode: 'include'\n  }\n}\n\n// Runtime approval for additional safety\ntoolApproval: async (toolCalls) => ({\n  approvals: toolCalls.map(tool => {\n    if (tool.function.name === 'writeFile') {\n      return { approve: false, reason: 'Write requires manual approval' };\n    }\n    return true;\n  })\n})\n"})}),"\n",(0,l.jsx)(n.h3,{id:"3-use-dynamic-port-and-api-keys",children:"3. Use Dynamic Port and API Keys"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-javascript",children:"const { httpPort } = global.context.info;\nconst { INFERENCE_API_KEY } = global.context.env;\n\nllm: {\n  endpoint: `http://127.0.0.1:${httpPort}/mimik-ai/openai/v1/chat/completions`,\n  apiKey: `Bearer ${INFERENCE_API_KEY}`\n}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"4-set-appropriate-limits",children:"4. Set Appropriate Limits"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-javascript",children:"{\n  maxIterations: 10,  // Allow complex multi-step tasks\n  llm: {\n    max_tokens: 4096,\n    temperature: 0.1\n  }\n}\n"})}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"related",children:"Related"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"/docs/ai-foundation/development/how-ai-agent-mims-work",children:"How AI Agent mims Work"}),": Understand the architecture and concepts"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"/docs/ai-foundation/development/create-ai-agent",children:"Create an AI Agent"}),": Hands-on tutorial"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"/docs/api/inference",children:"Inference API"}),": AI Foundation inference endpoints"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"/docs/api/context/http",children:"context.http"}),": HTTP client for mims"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}},8453(e,n,t){t.d(n,{R:()=>r,x:()=>o});var i=t(6540);const l={},s=i.createContext(l);function r(e){const n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:r(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);